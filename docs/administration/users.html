<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
	<title>5.3. Управление пользователями</title>
</head>
<link rel="stylesheet" href="../css/styles.css">
<body style="margin: 0px 150px 0px 150px">

<table summary="Header navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<th colspan="3" align="center">Администрирование Calmira GNU/Linux</th>
</tr>

<table summary="Footer navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="processes.html"
accesskey="P">Назад</a></td>
<td width="34%" align="center" valign="top"><a href="index.html"
accesskey="H">Домой</a></td>
<!--<td width="34%" align="right" valign="top"><a href="../.html"
accesskey="N">Далее</a></td>-->

</tr>

<tr>
<td width="33%" align="left" valign="top">Управление процессами</td>
<td width="34%" align="center" valign="top">&nbsp;</td>
<!--<td width="33%" align="right" valign="top">Управление пользователями</td>-->
</tr>
</table>

<hr align="LEFT" width="100%" />

<h1>Управление пользователями</h1>

<p>Даже если за компьютером работает только один человек, необходимо понимать принципы управления пользователями в Linux. Для повседневной работы за ПК с Linux вполне хватит непривелигированного пользователя, а для настройки и восстановления системы понадобится пользователь с другим уровнем доступа. Так же очень важен аспект контроля других пользователей, а они идентифицируются в системе по своим именам.</p>

<p>В Linux существует три типа пользователей:</p>

<ul>
	<li><tt>root</tt> - суперпользователь. Имеет право на выполнение всех операций без исключения. В Calmira Linux включен по умолчанию.</li>
	<li>Системные пользователи - создаются системой автоматически. Предназначены для некоторых процессов для управления привилегиями и правами доступа к файлам.</li>
	<li>Обычные пользователи - создаются системным администратором. Предназначены для работы обычных людей.</li>
</ul>

<p>Каждый пользователь имеет своё имя в системе. Имена нескольких пользователей не могут повторяться (т.е. не может быть двух юзеров с одинаковым именем).</p>

<p>Каждый пользователь имеет числовой идентификатор <tt>UID - User Identificator</tt> (об этом можно проситать и в предыдущей инструкции). <tt>root</tt> имеет идентификатор 0. Системные пользователи - от 1 до 100. Обычные пользователи - от 100.</p>

<p>Пользователи могут объединяться в группы. Каждый пользователь <em>обязательно</em> входит в ту, или иную группу. Группы так же имеют числовой идентификатор (<tt>GID - Group Identificator</tt>).</p>

<h2>Введение</h2>

<p>Система регистрирует следующую информацию о пользователе:</p>

<ol>
	<li>
		Имя пользователя (<tt>username</tt>). Как уже упоминалось выше, имя должно быть уникальным в системе. В именах могут быть использованы <strong>только</strong> английские буквы, а так же цифры и символы <tt>_</tt> (нижнее подчёркивание) и <tt>.</tt> (точка).
	</li>
	<li>
		Полное имя. Помимо обычного имени пользователя, заносится имя и "реального". Например, иногда полное имя содержит в себе имя и фамилию реального человека, использующего ПК.
	</li>
	<li>
		Идентификационный номер пользователя (<tt>UID</tt>). По этому номеру система отслеживает пользователя (а не по его имени).
	</li>
	<li>
		Идентификационный номер группы (<tt>GID</tt>). Этот номер означает группу, в которую входит пользователь. Группы позволяют регулировать доступ юзеров к различным ресурсам. Принадлежность к определённой группе устанавливает системный администратор.
	</li>
	<li>
		Пароль (<tt>password</tt>). Каждый пользователь для доступа к своему аккаунту должен иметь пароль (он зашифрован). Без пароля не будет доступа к аккаунту.
	</li>
	<li>
		Домашний каталог. Это название каталога, в который попадает пользователь после того, как зарегистрируется в системе (с помощью программы <tt>login</tt>), и где хранятся его собственные файлы (документы, музыка и прочее). Обычно такой каталог находится в <tt>/home</tt>, однако такое поведение можно изменить (но не рекомендуется, чтобы не нарушать стандарт FHS, которому следует Calmira Linux).
	</li>
	<li>
		Начальная оболочка (<tt>login shell</tt>). Командная оболочка, которая запускается после входа в систему. По умолчанию это <tt>/bin/bash</tt>, однако при установке другой (например, <tt>zsh</tt>, <tt>tcsh</tt> и пр.), стандартный <tt>bash</tt> можно заменить на другую.
	</li>
</ol>

<p>Вся информация находится в <tt>/etc/passwd</tt>. Строки имеют следующий формат:</p>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
имя пользователя:зашифрованный пароль:UID:GID:полное имя:домашний каталог:оболочка
</pre></td></tr></table>

<p>Например:</p>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
administrator:Xv8Q981g71oKK:1000:1000:Михаил Краснов:/home/administrator:/bin/bash
</pre></td></tr></table>

<p>Для обеспечения безопасности пароли не хранятся в "читабельном" виде, а зашифрованы. Для того, чтобы расшифровать пароль, нужно его знать. Такая форма является достаточно надёжной.</p>

<p>Так же пароли могут храниться не в <tt>/etc/passwd</tt>, а в <tt>/etc/shadow</tt> (такие называются <em>теневыми паролями</em>). Права на чтение у него ограничены, когда как <tt>/etc/passwd</tt> может читать почти каждый. Вынос паролей в <tt>/etc/shadow</tt> является более безопасной. Теневые пароли так же обеспечивают дополнительные функции, например, ограниченный срок действия пароля.</p>

<h2>Создание пользователей</h2>

<p>Создание пользователя обязательно понадобится всем администраторам этой системы. Знания об управлении пользователями могут понадобиться как после установки/сборки дистрибутива, так и во время эксплуатации.</p>

<p>При создании новых пользователей надо совершить несколько действий. Во-первых, сделать запись в <tt>/etc/passwd</tt>, где пользователю дают уникальное имя и UID. User ID обычных пользователей должен быть (<strong>обязательно</strong>) больше ста, так как низкие значения зарезервированы для другого типа пользователей. Так же указывается GID, реальное имя и другая информация. Дальше нужно создать домашний каталог (по стандарту FHS должен находиться в одноимённой с пользователем поддиректории <tt>/home</tt>), права на который выставить таким образом, что каталогом владеет только данный юзер. В каталог помещаются конфигурационные файлы для командной оболочки <tt>sh</tt> или <tt>bash</tt>, а так же конфиги других приложений. Значения в этих файлах уникальны для каждого пользователя, общесистемные настройки располагаются в директории <tt>/etc</tt>. При необходимости редактируются нужные <em>системные</em> конфигурационные файлы (например, если установлен <tt>sudo</tt>, то <tt>/etc/sudoers</tt> для разрешения нужному пользователю доступ к этой утилите).</p>

<p>По каким-то причинам вы не хотите/можете вручную создать пользователя. Эта операция может быть даже затруднительной, когда нужно управлять сразу несколькими юзерами. На этот случай в Calmira Linux установлены <tt>adduser</tt> и <tt>useradd</tt>.</p>

<p>В директории <tt>/etc/skel</tt> находятся настройки (в конфигах) и прочие файлы по умолчанию для новых пользователей (не путать с общесистемными настройками!). Всё из этого каталога будет скопировано в домашнюю директорию нового созданного (с помощью <tt>useradd</tt>) пользователя.</p>

<h2>Удаление пользователей</h2>

<p>Соответственно, для удаления пользователя используются <tt>userdel</tt> или <tt>deluser</tt>. А можно и вручную - удалив всё, что создали.</p>

<h2>Временный запрет на логин пользователя</h2>

<p>В некоторых ситуациях необходимо не удалять пользователя, а запретить ему вход в систему. В таком случае, нужно отредактировать <tt>/etc/passwd</tt>: поставить перед паролем знак звёздочки (<tt>*</tt>).</p>

<p>Было:</p>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
administrator:Xv8Q981g71oKK:1000:1000:Михаил Краснов:/home/administrator:/bin/bash
</pre></td></tr></table>

<p>Стало:</p>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
administrator:*Xv8Q981g71oKK:1000:1000:Михаил Краснов:/home/administrator:/bin/bash
</pre></td></tr></table>

<p>Теперь вход в систему пользователя <tt>administrator</tt> невозможен.</p>

<h2>Дополнительная настройка</h2>

<p>Первым делом нужно дать пароль новому пользователю. Для этого используется утилита <tt>passwd</tt>. Изменять пароли любых пользователей может только <tt>root</tt>, но никто более, когда как сами пользователи могут изменять/давать себе новые пароли сами.</p>

<p>Для того, чтобы дать новый пароль пользователю (от имени <tt>root</tt> выполнить):</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
passwd <em>user</em>
</pre></td></tr></table>

<h2>Группы пользователей</h2>

<p>Каждый пользователь входит в одну или несколько групп. Достоинство в правах доступа - в разных группах они могут быть разными. У каждого файла есть не только владелец-пользователь, но и владелец-группа, а так же набор прав доступа, определяющих, как пользователи из этой группы могут осуществлять доступ к этому файлу. При создании пользователя создаётся одноимённая с ним группа, куда входит один пользователь.</p>

<p>Информация о группах содержится в файле <tt>/etc/group</tt>. Формат каждой строки:</p>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
имя группы:пароль:GID:другие члены группы
</pre></td></tr></table>

<p>Примеры групп из Calmira Linux:</p>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
root:x:0:
bin:x:1:daemon
sys:x:2:
kmem:x:3:
tape:x:4:
tty:x:5:
daemon:x:6:
floppy:x:7:
disk:x:8:
</pre></td></tr></table>

<blockquote><p>Как вы могли заметить, пароли как пользователей (<tt>/etc/passwd</tt>), так и групп (<tt>/etc/group</tt>) уже не находятся в этих файлах, а вынесены в отдельные конфиги с другими правами доступа к ним.</p></blockquote>

<p>Пользователи могут принадлежать к нескольким группам одновременно. Команда <tt>groups</tt> отобразит список групп, в которую входит пользователь, запустивший её.</p>
