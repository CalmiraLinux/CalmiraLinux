<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
	<title>Создание порта</title>
</head>
<link rel="stylesheet" href="../../styles.css">
<body style="margin: 0px 150px 0px 150px">

<table summary="Header navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<th colspan="3" align="center">Управление пакетами в Calmira GNU/Linux</th>
</tr>

<table summary="Footer navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="intro_cpkg.html"
accesskey="P">Назад</a></td>
<td width="34%" align="center" valign="top"><a href="index.html"
accesskey="H">Домой</a></td>
<td width="33%" align="right" valign="top"><a href="makepkg.html"
accesskey="N">Далее</a></td>

</tr>

<tr>
<td width="33%" align="left" valign="top">Введение в cpkg</td>
<td width="34%" align="center" valign="top">&nbsp;</td>
<td width="33%" align="right" valign="top">Создание бинарного пакета для cpkg</td>
</tr>
</table>

<hr align="LEFT" width="100%" />

<h1>Создание порта</h1>

<p>От помощи в создании порта для сборки какого-либо пакета мы никогда не откажемся. Если есть какие-либо заинтересованные в помощи люди - вы нам нужны.</p>

<h2>Начальный этап</h2>

<p>Создайте у себя на GitLab форк <a href="https://gitlab.com/Linuxoid85/calmira_ports">этого</a> репозитория, после чего приступайте к работе. Советуем вам клонировать этот репозиторий себе на ПК для удобной работы:</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
git clone https://gitlab.com/USERNAME/calmira_ports
cd calmira_ports
</pre></td></tr></table>

<p>Замените <em><tt>USERNAME</tt></em> на имя пользователя GitLab.</p>

<p>После этих действий вы можете приступать к созданию порта. Хотим обратить ваше внимание на то, что строение порта должно повторять строение других портов.</p>

<h2>Структура системы портов</h2>

<p>Просим вас соблюдать структуру системы портов:</p>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
КАТЕГОРИЯ
├── makeport.sh
└── ИМЯ_ПАКЕТА
    ├── install
    ├── install_doc.sh
    └── config.sh
</pre></td></tr></table>

<p>Здесь приведена общая структура системы портов. <tt>КАТЕГОРИЯ</tt> и <tt>ИМЯ_ПАКЕТА</tt> - директории. КАТЕГОРИЯ - имя категории, в которую входит пакет с именем ИМЯ_ПАКЕТА.</p>

<p>Файл <em><tt>makeport.sh</tt></em> нужен для автоматизации создания порта. Он создаёт директорию с именем порта, а так же файл <em><tt>install</tt></em> и откывает его в вашем текстовом редакторе, установленном по умолчанию. Наличие этого файла необязательно. Синтаксис:</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
./makeport.sh $ИМЯ_ПАКЕТА
</pre></td></tr></table>

<p>Файл <em><tt>install</tt></em> необходим. Он содержит инструкции по сборке ПО из исходного кода. Файл <em><tt>install_doc.sh</tt></em> опционален. Если у пакета есть дополнительная документация, которая не устанавливается по умолчанию, то в файле <em><tt>install_doc.sh</tt></em> содержатся инструкции по установке документации. Запускать его или нет - зависит от выбора пользователя. Он выбирает нужный ответ в диалоговом окне.</p>

<p>Файл <em><tt>config.sh</tt></em> содержит информацию о пакете. Она может быть добавлена в базу данных <tt>cpkg</tt> для удобного управления пакетом (так как система портов не умеет отображать информацию о пакете и удалять его, для таких целей используется <tt>cpkg</tt>). Наличие этого файла <strong>ОБЯЗАТЕЛЬНО</strong>, так же как и файла <em><tt>install</tt></em>.</p>

<strong><img src="../../pic/note.png" /> Смотрите также:</strong>

<blockquote><p>Для установки какого-либо текстового редактора по умолчанию (в TTY) экспортируйте переменную <tt>EDITOR</tt>, значение которой - путь до исполняемого бинарного файла редактора.</p></blockquote>

<h2>Создание нужных файлов</h2>

<p>Перейдите в одну из нужных директорий, выполните:</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
./makeport.sh $PACKAGE_NAME
</pre></td></tr></table>

<p>Замените <tt>$PACKAGE_NAME</tt> на имя порта. Скрипт <tt>makeport.sh</tt> создаёт нужную директорию и записывает в файл нужную информацию, которая должна содержаться в файле порта.</p>

<p>Если вы не нашли этот скрипт, скопируйте его из любой другой директории.</p>

<p>Будет создан файл <em><tt>install</tt></em> в директории, имеющей имя порта, который вы хотите создать. Этот файл будет открыт для редактирования в вашем текстовом редакторе, установленном по умолчанию. Замените строки</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
# Port created by Linuxoid85
#
# (C) 2021 Michail [Linuxoid85] Krasnov <linuxoid85@gmail.com>
</pre></td></tr></table>

на строки с вашим именем.

<p>Строки </p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
wget 
tar -xf 
cd 
</pre></td></tr></table>

<p>Предназначены для того, чтобы подставить в их конец нужную информацию. <tt>wget</tt> скачивает архив с исходным кодом, <tt>tar -xf</tt> распаковывает его, а <tt>cd</tt> переходит в распакованную директорию.</p>

<p>Запишите в конец файла нужные инструкции для сборки. Доступны все команды bash.</p>

<p>Если можно установить дополнительную документацию, то в конце открытого в редакторе файла вызовите функцию <tt>print_document_dial</tt>:</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
print_document_dial
</pre></td></tr></table>

<p>Он будет запрашивать у пользователя, ставить ли дополнительную документацию пакета.</p>

<p>Запишите нужные инструкции для установки документации в файл <tt>install_doc.sh</tt> и поместите его в ту же директорию, что и файл <tt>install</tt>.</p>

<p>После чего создайте файл <em><tt>config.sh</tt></em> и запишите в него информацию о пакете. Строение этого файла аналогично тому, что используется в пакетном менеджере <tt>cpkg</tt>. О создании этого файла читайте в <a href="makepkg.sh">этой</a> странице руководства.</p>

<h2>Отправка изменений на github</h2>

<p>Если вы клонировали репозиторий себе на ПК, выполните:</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
# Фиксирование изменений
git add .
git commit -m "Добавление порта с пакетом $PACKAGE_NAME"

# Отправка изменений себе на GitLab
git push
</pre></td></tr></table>

<p>Замените <tt>$PACKAGE_NAME</tt> на имя порта с пакетом.</p>

<p>Если вы делали всё в Web, то отметьте изменения с помощью графического интерфейса GitLab.</p>

<p>Создайте запрос на слияние (pull-request). Создание порта завершено!</p>

<hr align="LEFT" width="100%" />

<table summary="Footer navigation table" width="100%" border="0" cellpadding="0"
cellspacing="0">
<tr>
<td width="33%" align="left" valign="top"><a href="intro_cpkg.html"
accesskey="P">Назад</a></td>
<td width="34%" align="center" valign="top"><a href="index.html"
accesskey="H">Домой</a></td>
<td width="33%" align="right" valign="top"><a href="makepkg.html"
accesskey="N">Далее</a></td>

</tr>

<tr>
<td width="33%" align="left" valign="top">Введение в cpkg</td>
<td width="34%" align="center" valign="top">&nbsp;</td>
<td width="33%" align="right" valign="top">Создание бинарного пакета для cpkg</td>
</tr>
</table><br>
</body></html>
