# Создание порта

От помощи в создании порта для сборки какого-либо пакета мы никогда не откажемся. Если есть какие-либо заинтересованные в помощи люди - вы нам нужны.

## Начальный этап

Создайте у себя на GitLab форк [этого](https://gitlab.com/Linuxoid85/calmira_ports) репозитория, после чего приступайте к работе. Советуем вам клонировать этот репозиторий себе на ПК для удобной работы:

```bash
git clone https://gitlab.com/USERNAME/calmira_ports
cd calmira_ports
```

Замените `USERNAME` на имя пользователя GitLab.

После этих действий вы можете приступать к созданию порта. Хотим обратить ваше внимание на то, что строение порта должно повторять строение других портов.

## Структура системы портов

Просим вас соблюдать структуру системы портов:

```
КАТЕГОРИЯ
├── makeport.sh
└── ИМЯ_ПАКЕТА
    ├── install
    ├── install_doc.sh
    └── config.sh
```

Здесь приведена общая структура системы портов. `КАТЕГОРИЯ` и `ИМЯ_ПАКЕТА` - директории. КАТЕГОРИЯ - имя категории, в которую входит пакет с именем ИМЯ_ПАКЕТА.

Файл `makeport.sh` нужен для автоматизации создания порта. Он создаёт директорию с именем порта, а так же файл `install` и откывает его в вашем текстовом редакторе, установленном по умолчанию. Наличие этого файла необязательно. Синтаксис:

```bash
./makeport.sh $ИМЯ_ПАКЕТА
```

Файл `install` необходим. Он содержит инструкции по сборке ПО из исходного кода. Файл `install_doc.sh` опционален. Если у пакета есть дополнительная документация, которая не устанавливается по умолчанию, то в файле `install_doc.sh` содержатся инструкции по установке документации. Запускать его или нет - зависит от выбора пользователя. Он выбирает нужный ответ в диалоговом окне.

Файл `config.sh` содержит информацию о пакете. Она может быть добавлена в базу данных `cpkg` для удобного управления пакетом (так как система портов не умеет отображать информацию о пакете и удалять его, для таких целей используется `cpkg`). Наличие этого файла ОБЯЗАТЕЛЬНО, так же как и файла `install`.

## Создание нужных файлов

Перейдите в одну из нужных директорий, выполните:

```bash
./makepkg.sh $PACKAGE_NAME
```

Замените `$PACKAGE_NAME` на имя порта. Скрипт `makepkg.sh` создаёт нужную директорию и записывает в файл нужную информацию, которая должна содержаться в файле порта.

Если вы не нашли этот скрипт, скопируйте его из любой другой директории.

Будет создан файл `install` в директории, имеющей имя порта, который вы хотите создать. Этот файл будет открыт для редактирования в вашем текстовом редакторе, установленном по умолчанию. Замените строки

```bash
# Port created by Linuxoid85
#
# (C) 2021 Michail [Linuxoid85] Krasnov <linuxoid85@gmail.com>
```

на строки с вашим именем.

Строки 
```bash
wget 
tar -xf 
cd 
```

Предназначены для того, чтобы подставить в их конец нужную информацию. `wget` скачивает архив с исходным кодом, `tar -xf` распаковывает его, а `cd` переходит в распакованную директорию.

Запишите в конец файла нужные инструкции для сборки. Доступны все команды bash.

Если можно установить дополнительную документацию, то в конце открытого в редакторе файла вызовите функцию `print_document_dial`:

```bash
print_document_dial
```

Он будет запрашивать у пользователя, ставить ли дополнительную документацию пакета.

Запишите нужные инструкции для установки документации в файл `install_doc.sh` и поместите его в ту же директорию, что и файл `install`.

После чего создайте файл `config.sh` и запишите в него информацию о пакете. Строение этого файла аналогично тому, что используется в пакетном менеджере `cpkg`. О создании этого файла читайте в [этой](makepkg.sh) странице руководства.

## Отправка изменений на github

Если вы клонировали репозиторий себе на ПК, выполните:

```bash
git add .
git commit -m "Добавление порта с пакетом $PACKAGE_NAME"

# Отправка изменений себе на GitLab
git push
```

Замените `$PACKAGE_NAME` на имя порта с пакетом.

Если вы делали всё в Web, то отметьте изменения с помощью графического интерфейса GitLab.

Создайте запрос на слияние (pull-request). Создание порта завершено!

***

[Назад - Создание бинарного пакета для cpkg](makepkg.md)
